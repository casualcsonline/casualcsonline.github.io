[{"content":"I\u0026rsquo;ve recently had a handful of discussions with folks about what Docker is and how it works. The world definitely needs another \u0026ldquo;getting started with docker\u0026rdquo; guide, and I figured it was high time I write one up too.\nWhat We\u0026rsquo;ll Cover By the end of this article, you should have a decent grasp of how Docker images and containers work under the hood. We\u0026rsquo;ll cover:\n What a docker image is. How a docker container works. The relationship between a docker image and a docker container. Why Docker might be helpful for you. How to create a basic docker image.  What We Won\u0026rsquo;t Cover  How Docker works for networks, and how containers can talk to each other. How the Docker Daemon actually runs containers. We won\u0026rsquo;t even explain what the Docker Daemon is. Any information about other container runtimes. How any of this works on operating systems that aren\u0026rsquo;t linux.  Definitions Before we dive in too deeply, let\u0026rsquo;s make sure we\u0026rsquo;re all speaking the same language.\n Image An \u0026ldquo;Image\u0026rdquo; is a cookie cutter for a docker container. When you have an image, you can stamp out as many containers based on that image as you like. Container A \u0026ldquo;Container\u0026rdquo; is an instance of your \u0026ldquo;Image\u0026rdquo;. Following the \u0026ldquo;cookie cutter\u0026rdquo; comparison, this is a single cookie. It may look and smell like all of the other cookies on your baking sheet, but it acts as its own independent morsel. Dockerfile A set of instructions to create an \u0026ldquo;Image\u0026rdquo;. Think of it like a cookie recipe. Namespace A \u0026ldquo;Namespace\u0026rdquo; is a way to isolate your cookies from your neighbor\u0026rsquo;s cookies. Everything we need to know about our delicious chocolate chip cookies are contained in a set of namespaces, and within our namespaces we don\u0026rsquo;t even know that Jim\u0026rsquo;s oatmeal raisin cookies exist. Container Runtime Really, Docker is just one type of \u0026ldquo;Container Runtime\u0026rdquo;. Much like you can write the same program in almost any language, you can create and run containers in several different runtimes. For today, we\u0026rsquo;ll acknowledge that these other runtimes exist and then go right back to ignoring them.  What is Docker, really? The thing we know as \u0026ldquo;Docker\u0026rdquo; is just some fancy UX around a technology known as Namespaces. Namespaces are, basically, boxes made of fancy one-way mirrors. When you put things in this box, they can\u0026rsquo;t see out and only things that aren\u0026rsquo;t in other boxes can see in.\nDocker does a great job of combining a few types of boxes and making it easy for us to put things in them. The main box we\u0026rsquo;re concerned with today is known as a \u0026ldquo;process namespace\u0026rdquo; - any running process in this box is only aware of other processes if they\u0026rsquo;re also inside of this box. We\u0026rsquo;ll also talk about a \u0026ldquo;mount namespace\u0026rdquo; or \u0026ldquo;filesystem namespace\u0026rdquo;1 - any running process in this box is only aware of files that we\u0026rsquo;ve placed inside of this box.\nLet\u0026rsquo;s go back to our cookie cutter example. If a docker image is a cookie cutter, than a computer is made up of cookie dough. We can take our cookie cutter and stamp it down on our cookie dough and BAM, we have a gingerbread person. Likewise, we can take our docker image and stamp it down on our computer and BAM we have a container with its associated process and filesystem namespaces. If we take our cookie cutter and put it away for the season2, we can take it out again next year and stamp it down in a new batch of dough and get a gingerbread person of the exact same shape. Likewise, we can take our docker image over to somebody else\u0026rsquo;s computer and run a container that looks exactly the same.\nHow is this different from a virtual machine? Sticking with our analogy, starting a virtual machine is like creating a whole new batch of cookie dough. A docker image assumes you already have some cookie dough around, and is happy to make use of what you\u0026rsquo;ve got.\nThe big impact here is that it\u0026rsquo;s wicked fast to start up a container from an image, whereas starting a virtual machine takes a fair bit of time. Containers also require far fewer resources than virtual machines, since they play nicely with the operating system they\u0026rsquo;re running under rather than having to create an entirely new operating system.\nWhy does any of this matter? I think that the most compelling reason to start using docker is that it makes it trivial to run your code in different places without any changes. If you have a docker image that works on your computer, it\u0026rsquo;ll almost certainly work on somebody else\u0026rsquo;s computer as well.\nThis means no more mucking around with code dependencies when you try to run your code somewhere else. So long as you\u0026rsquo;ve set up your cookie cutter docker image with the versions of the dependencies you need, you can stamp out a docker container on another machine and have it start right up.\nYour first image and container The starting point for any image is called a Dockerfile. It acts as the recipe for your cookies, and can be used to make cookie dough whenever you like. From this Dockerfile, we can create a docker Image that we\u0026rsquo;ll eventually run as a docker Container.\nThe Dockerfile Let\u0026rsquo;s set up a basic dockerfile and walk through what happens:\nFROM ubuntu # Line 1 ENTRYPOINT [\u0026quot;cat\u0026quot;] # Line 2 CMD [\u0026quot;/etc/issue\u0026quot;] # Line 3  On Line 1, we specify a jumping off point for our recipe. This is like saying \u0026ldquo;go get some flour and some chocolate chips\u0026rdquo; - you don\u0026rsquo;t need to grow wheat or cacao trees, you just need some of the finished products so you can combine them in a way you like.\nOn Line 2, we tell the image what the container should do when it starts up. This is like preheating your oven - get some things set up so you can get your cookies baking easily. Note that the Image doesn\u0026rsquo;t actually run this command. It just tells sets us up so that when we eventually create a Container from this Image, that Container will run this command.\nOn Line 3, we specify some default arguments that will be passed to our Entrypoint when the Container eventually starts. These arguments can be overriden by the Container when it starts up. In this particular instance, I\u0026rsquo;ve chosen the name of the first file I can think of that will definitely exist in this image3 - there\u0026rsquo;s nothing special about this particular file.\nFrom a Dockerfile to a Docker Image To create an Image from this Dockerfile, we\u0026rsquo;ll run the following in our shell. If you want to actually run it, you\u0026rsquo;ll likely have to remove the comments:\ndocker build \\ # Line 1 --file Dockerfile \\ # Line 2 --tag chocolatechip \\ # Line 3 . # Line 4  On Line 1, we tell docker we want to build some stuff.\nOn Line 2, we tell docker the recipe we want to build from. Dockerfile is actually the default here, so we don\u0026rsquo;t have to say this, but I like being explicit.\nOn Line 3, we tell docker what we want to \u0026ldquo;tag\u0026rdquo;, or \u0026ldquo;name\u0026rdquo; the resulting image.\nOn Line 4, we tell docker the \u0026ldquo;context\u0026rdquo; we want to use to build our image. We\u0026rsquo;re going to gloss over this - just use . (the current directory) for now.\nWhen you run the command, you\u0026rsquo;ll see output very similar to the following:\n❯ docker build --file Dockerfile --tag chocolatechip . Sending build context to Docker daemon 2.048kB Step 1/3 : FROM ubuntu latest: Pulling from library/ubuntu 83ee3a23efb7: Pull complete db98fc6f11f0: Pull complete f611acd52c6c: Pull complete Digest: sha256:703218c0465075f4425e58fac086e09e1de5c340b12976ab9eb8ad26615c3715 Status: Downloaded newer image for ubuntu:latest ---\u0026gt; f63181f19b2f Step 2/3 : ENTRYPOINT [\u0026quot;cat\u0026quot;] ---\u0026gt; Running in 6216f1bc7328 Removing intermediate container 6216f1bc7328 ---\u0026gt; 16e1ee9a39fb Step 3/3 : CMD [\u0026quot;/etc/issue\u0026quot;] ---\u0026gt; Running in b50691f519fd Removing intermediate container b50691f519fd ---\u0026gt; d9c66e31bdfa Successfully built d9c66e31bdfa Successfully tagged chocolatechip:latest  We now have a docker image called chocolatechip! Notice that each Step corresponds to a line in our Dockerfile. Also notice that the very first step resulted in some stuff being \u0026ldquo;Pulled\u0026rdquo; - this is docker going to the grocery store to buy flour and chocolate chips.\nFrom a Docker Image to Docker Containers Now that we have a docker image, we can run it as many times as we like:\n❯ docker run chocolatechip Ubuntu 20.04.1 LTS \\n \\l ❯ docker run chocolatechip Ubuntu 20.04.1 LTS \\n \\l ❯ docker run chocolatechip Ubuntu 20.04.1 LTS \\n \\l ❯ docker run chocolatechip Ubuntu 20.04.1 LTS \\n \\l  Each time, the output is identical to the previous time. The command also completes nearly instantly! All of the hard work of going to get flour and chocolate chips is already done - we just have to stamp out cookies.\nNow we can check to see that we actually made a bunch of different cookies:\n❯ docker ps --all # List all containers that are running or have run in the past CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES e969783110b9 chocolatechip \u0026quot;cat /etc/issue\u0026quot; About a minute ago Exited (0) About a minute ago reverent_williams 9df76df03001 chocolatechip \u0026quot;cat /etc/issue\u0026quot; About a minute ago Exited (0) About a minute ago pedantic_keller caebbe2d859a chocolatechip \u0026quot;cat /etc/issue\u0026quot; About a minute ago Exited (0) About a minute ago xenodochial_johnson 96f65378d930 chocolatechip \u0026quot;cat /etc/issue\u0026quot; About a minute ago Exited (0) About a minute ago jolly_neumann a71ff73e2c32 chocolatechip \u0026quot;cat /etc/issue\u0026quot; About a minute ago Exited (0) About a minute ago jovial_wescoff  We have a bunch of different containers that are all based on our chocolatechip image, and have run the same COMMAND - cat /etc/issue, a combination of the ENTRYPOINT and CMD steps from Dockerfile, just as we expected.\nDoing something slightly different Now that we have our chocolatechip cookie cutter, we might want to deviate just a little bit from our main shape - add some sprinkles or something. That\u0026rsquo;s why we specified the file we wanted to view as a CMD. We can swap out the CMD by passing some more arguments to docker run:\n❯ docker run chocolatechip /etc/debian_version bullseye/sid  And listing our docker containers again:\n❯ docker ps --all CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES fd6f86dd15a2 chocolatechip \u0026quot;cat /etc/debian_ver…\u0026quot; 18 seconds ago Exited (0) 18 seconds ago jolly_solomon e969783110b9 chocolatechip \u0026quot;cat /etc/issue\u0026quot; 6 minutes ago Exited (0) 6 minutes ago reverent_williams 9df76df03001 chocolatechip \u0026quot;cat /etc/issue\u0026quot; 6 minutes ago Exited (0) 6 minutes ago pedantic_keller caebbe2d859a chocolatechip \u0026quot;cat /etc/issue\u0026quot; 6 minutes ago Exited (0 6 minutes ago xenodochial_johnson 96f65378d930 chocolatechip \u0026quot;cat /etc/issue\u0026quot; 6 minutes ago Exited (0) 6 minutes ago jolly_neumann a71ff73e2c32 chocolatechip \u0026quot;cat /etc/issue\u0026quot; 7 minutes ago Exited (0) 7 minutes ago jovial_wescoff  And we see that we have a new container, still based on our chocolatechip cookie cutter image, but doing something just slightly different.\nWrap Up And that\u0026rsquo;s our whirlwind tour of baking docker!\n  While I can\u0026rsquo;t find any evidence that the term \u0026ldquo;filesystem namespace\u0026rdquo; is wrong, I also can\u0026rsquo;t find any that it\u0026rsquo;s correct. It doesn\u0026rsquo;t require me to explain what a \u0026ldquo;mount\u0026rdquo; is though, so I\u0026rsquo;m sticking with it. \u0026#x21a9;\u0026#xfe0e;\n Cookie Cutters are only useful in December, right? \u0026#x21a9;\u0026#xfe0e;\n I want you to be able to run the examples I show here \u0026#x21a9;\u0026#xfe0e;\n  ","date":"2021-02-24","permalink":"https://casualcs.dev/posts/docker/","tags":["docker","containers","intro"],"title":"Docker 101"}]